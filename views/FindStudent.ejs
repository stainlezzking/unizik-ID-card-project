<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <meta name="description" content="a Unizik project by a student of the school in Mathematics 300L who goes by the name of stanley Chukwuebuka Azuka">
    <link rel="stylesheet" href="static/headerStyles.css"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <link rel="shortcut icon" href="static/logo.png">
</head>
<style>
    *{
        box-sizing: border-box;
    }
    .camera_cover {
        width: 8vw;
        height: 8vw;
        min-width: 80px;
        min-height: 80px;
        background: aqua;
        display: flex;
        justify-content: center;
        align-items: center;
        border-radius: 50%;
        cursor: pointer;
        box-shadow: 0px 8px 20px gray;
    }
    svg{
        width: 70%;
    }
    body {
        height: 100vh;
        display: flex;
        flex-direction: column;
    }
    .camera_case{
        flex-grow: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
    }
    #preview {
        width: 100%;
        margin:0px auto;
        height: 0px;
        transition: height 1s ;
        padding-bottom:10px;
    }
 .loader {
  animation: spin 1s infinite linear;
  border: solid 2vmin transparent;
  border-radius: 50%;
  border-right-color: #09f;
  border-top-color: #09f;
  box-sizing: border-box;
  height: 20vmin;
  left: calc(50% - 10vmin);
  position: fixed;
  top: calc(50% - 10vmin);
  width: 20vmin;
  z-index: 1;
  display: none;
}
.loader:before {
  animation: spin 2s infinite linear;
  border: solid 2vmin transparent;
  border-radius: 50%;
  border-right-color: #3cf;
  border-top-color: #3cf;
  box-sizing: border-box;
  content: "";
  height: 16vmin;
  left: 0;
  position: absolute;
  top: 0;
  width: 16vmin;
}
.loader:after {
  animation: spin 3s infinite linear;
  border: solid 2vmin transparent;
  border-radius: 50%;
  border-right-color: #6ff;
  border-top-color: #6ff;
  box-sizing: border-box;
  content: "";
  height: 12vmin;
  left: 2vmin;
  position: absolute;
  top: 2vmin;
  width: 12vmin;
}

@keyframes spin {
  100% {
    transform: rotate(360deg);
  }
}
    
</style>
<body>
    <header class="container-fluid bg-light d-flex align-items-center">
        <a href="/" class="brand">
            <img src="static/unizik.png" class="img-fluid" alt="the university of unizik brand">        
        </a>
        <div class="details">
            <h2> verify a student's status </h2>
            <div>
                <small class="text-success"> Scan the barcode behind the ID card to find a student</small>
            </div>
        </div>
    </header>
<section class="camera_case">
    <div class="loader"></div>
    <video id="preview">
        
    </video>
    <div class="camera_cover">
        <svg version="1.1" id="Layer_1"  x="0px" y="0px"
                viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve">
                <g>
                    <g>
                        <path d="M225.967,93.44V33.223H70.253V93.44H0v122.516v262.821h512V215.956V93.44H225.967z M85.461,48.431h125.298V93.44H85.461
                            V48.431z M496.792,215.956H386.426v15.208h110.366v232.405H15.208V231.164h70.545c-8.502,16.477-13.308,35.16-13.308,54.944
                            c0,66.292,53.933,120.226,120.226,120.226S312.897,352.4,312.897,286.108c0-19.784-4.807-38.466-13.308-54.944h66.558v-15.208
                            h-75.9c-21.85-30.306-57.445-50.074-97.576-50.074s-75.726,19.768-97.576,50.074H15.208V108.648h55.046h155.714h270.825V215.956z
                            M87.653,286.108c0-57.907,47.111-105.018,105.018-105.018c57.907,0,105.018,47.111,105.018,105.018
                            s-47.111,105.018-105.018,105.018C134.764,391.126,87.653,344.015,87.653,286.108z"/>
                    </g>
                </g>
                <g>
                    <g>
                        <path d="M336.213,134.625v55.354h115.57v-55.354H336.213z M436.575,174.771h-85.154v-24.938h85.154V174.771z"/>
                    </g>
                </g>
                <g>
                    <g>
                        <path d="M192.671,194.959c-50.26,0-91.15,40.889-91.15,91.149c0,50.26,40.89,91.149,91.15,91.149
                            c50.26,0,91.149-40.89,91.149-91.149C283.82,235.848,242.93,194.959,192.671,194.959z M192.671,362.049
                            c-41.875,0-75.942-34.068-75.942-75.941c0-41.874,34.068-75.941,75.942-75.941s75.941,34.068,75.941,75.941
                            C268.612,327.983,234.545,362.049,192.671,362.049z"/>
                    </g>
                </g>
                <g>
                    <g>
                        <path d="M131.936,286.108h15.208c0-25.103,20.423-45.525,45.526-45.525v-15.208C159.181,225.375,131.936,252.619,131.936,286.108z
                            "/>
                    </g>
                </g>
                <g>
                </g>
                <g>
                </g>
                <g>
                </g>
                <g>
                </g>
                <g>
                </g>
                <g>
                </g>
                <g>
                </g>
                <g>
                </g>
                <g>
                </g>
                <g>
                </g>
                <g>
                </g>
                <g>
                </g>
                <g>
                </g>
                <g>
                </g>
                <g>
                </g>
        </svg>
    </div>

</section>

    <script src="static/instascan.min.js"></script>
<script>
        // cdn="http://rawgit.com/schmich/instascan-builds/master/instascan.min.js"
    svgDuplicate = `${document.querySelector(".camera_cover").innerHTML}`

document.querySelector(".camera_cover").addEventListener("click",function(e){
    this.classList.toggle("scanning")
    if(this.classList.contains("scanning")){
        this.innerHTML= `<div style="font-size:2rem; font-weight:bold;"> X </div>`
        document.querySelector("#preview").style.height = "50%"
        Instascan.Camera.getCameras().then(function (cameras) {
         if (cameras.length > 0) {
            scanner.start(cameras[0]);
         } else {
            console.error('No cameras found.');
            }
        }).catch(function (e) {
            console.error(e.message);
        });

    }else{
        this.innerHTML= svgDuplicate
        document.querySelector("#preview").style.height = "0px"
        scanner.stop()
    }
} )
  
   
let scanner = new Instascan.Scanner({ video: document.getElementById('preview') });
     scanner.addListener('scan', function (reg) {
           if(reg && reg.length === 10 && typeof Number(reg) == "number" ){
                document.querySelector("#preview").style.height = "0px"
                document.querySelector(".camera_cover").style.display = "none"
                document.querySelector(".loader").style.display = "block"
                scanner.stop()
                console.log(reg)
                try{
                    fetch("/findStudent",{
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({regNumber: reg})
                })
                .then(data=> data.json())
                .then((data)=>{
                    if(data.err){
                        alert(data.err)
                    }
                    if(data.success){
                        document.querySelector("body").innerHTML = data.success
                    }
                })
                }catch(err){
                    console.log(err)
                }
           }
    });
     


</script>
</section>
</body>
</html>